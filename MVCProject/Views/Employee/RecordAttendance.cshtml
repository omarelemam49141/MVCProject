
@model IEnumerable<Student>
@{
    	ViewBag.Title = "Record Attendance";
        Layout = "~/Views/Shared/EmployeeDashBoard.cshtml";

	@*recieve the date from viewBag*@
		var students = ViewBag.Students as List<Student>;
		var tracks = ViewBag.Tracks as List<Track>;
		var intakes = ViewBag.Intakes as List<Intake>;

		SelectList trackList = new SelectList(tracks, "Id", "Name");
		SelectList intakeList = new SelectList(intakes, "Id", "Name");
		var listOfStudents = ViewBag.SRecord as List<StudentRecord> ?? new List<StudentRecord>();
}

<h2 class="text-center">Record Attendance</h2>
		<select id="selectedTrack" name="Tid" class="form-control w-50 mx-auto my-1">
    <option value="">Select Track</option>
	@foreach (var track in ViewBag.Tracks)
    {
		if(ViewBag.track == track.Id)
		{
			<option value="@track.Id" selected>
				@track.Name
			</option>
		}
		else
		{
			<option value="@track.Id">
				@track.Name
				</option>
		}
	}
</select>

<select id="selectedIntake" name="Iid" class="form-control w-50 mx-auto my-1">
	<option value="">Select Intake</option>
	@foreach (var intake in ViewBag.Intakes)
	{
		if (ViewBag.intake == intake.Id)
		{
			<option value="@intake.Id" selected>
				@intake.Name
			</option>
		}
		else
		{
			<option value="@intake.Id">
				@intake.Name
			</option>
		}
	}
</select>

 
<input type="date" value="@ViewBag.Date?.ToString("yyyy-MM-dd")" name="date" id="date" max="@DateOnly.FromDateTime(DateTime.Today).ToString("yyyy-MM-dd")" class="form-control w-50 mx-auto my-1" />

<a id="ShowStudents" href="#" class="btn btn-primary d-block w-25 mx-auto mt-2"> Show Students</a>


	
    <table class="table table-bordered hover">
        <thead>
			<tr>
				<th>Student Name</th>
				<th>Status</th>
			</tr>
        </thead>
        <tbody>

		@foreach (var student in listOfStudents)
		{
			<tr>
				<td>@student.Name</td>
				<td>
					<form asp-action="SaveRecords">
						<input name="StdID" value="@student.Id" hidden />
						<input name="Date" value="@DateTime.UtcNow.Date.ToString("yyyy-MM-dd")" hidden />
						<input name="TimeOfAttendance" value="@DateTime.Now.TimeOfDay" hidden />
						<select name="status" class="form-control">
							<option value="Present">Present</option>
							<option value="Absent">Absent</option>
							<option value="Late">Late</option>
						</select>
						<input type="submit" class="btn btn-primary"/>
					</form>
				</td>
			</tr>
		}

        </tbody>
    </table>

@section EmployeeScript{
	<script>
		
	
		document.getElementById("ShowStudents").addEventListener("click", (e) => {
			var Intake = document.getElementById("selectedIntake").value;
			var Track = document.getElementById("selectedTrack").value;
			console.log(Intake , Track)
			e.preventDefault();
			if (Intake != '' && Track != '') {
				window.location = "/Employee/RecordAttendance?Tid=" + Track + "&Iid=" + Intake;
				

			}

		})
	

	</script>

}


